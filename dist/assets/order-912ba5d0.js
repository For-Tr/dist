import{j as V,J as f,d as Y,b as A,l as F,A as P,r as m,o as n,e as v,f as k,n as g,y as s,C as p,F as T,c as d,z as c,g as u,m as r,p as j,h as E}from"./index-da835352.js";import{_ as M}from"./_plugin-vue_export-helper-c27b6911.js";const J=async a=>V({url:"/CSAA/admin/order/list",params:a,data:{},headers:{}}),I=async a=>f({url:"/CSAA/admin/order/delete",params:a,headers:{}}),U=async a=>f({url:"/CSAA/admin/order/cancel_order",params:a,headers:{}}),q=async a=>f({url:"/CSAA/admin/order/checkOut_order",params:a,headers:{}}),G=async a=>f({url:"/CSAA/admin/order/checkIn_order",params:a,headers:{}}),x=a=>(j("data-v-aecd9325"),a=a(),E(),a),H={class:"page-view"},Q={class:"table-operations"},W={key:1},X=x(()=>k("a",null,"Done",-1)),Z=x(()=>k("a",null,"Cancel",-1)),ee=x(()=>k("a",{style:{color:"red"}},"Delete",-1)),te=x(()=>k("a",null,"Schedule",-1)),oe=Y({__name:"order",setup(a){const R=A([{title:"No.",dataIndex:"index",key:"index",align:"center"},{title:"User(parent)",dataIndex:"username",key:"username",align:"center"},{title:"Phone nubmer",dataIndex:"receiver_phone",key:"receiver_phone",align:"center"},{title:"Class name",dataIndex:"title",key:"title",align:"center",customRender:({text:e})=>e?e.substring(0,10)+"...":"--"},{title:"Order status",dataIndex:"status",key:"status",align:"center",scopedSlots:{customRender:"status"}},{title:"Start time",dataIndex:"expect_time",key:"expect_time",align:"center"},{title:"Finish time",dataIndex:"return_time",key:"return_time",align:"center"},{title:"Remark",dataIndex:"remark",key:"remark",align:"center"},{title:"Order time",dataIndex:"order_time",key:"order_time",align:"center"},{title:"Operation",dataIndex:"action",key:"operation",align:"center",fixed:"right",width:200}]),o=A({tagList:[],loading:!1,keyword:"",selectedRowKeys:[],pageSize:20,page:1});F(()=>{_()});const _=()=>{o.loading=!0,J({keyword:o.keyword}).then(e=>{o.loading=!1,console.log(e),e.data.forEach((t,C)=>{t.index=C+1,t.expect_time=t.expect_time||"--",t.return_time=t.return_time||"--",t.room_number=t.room_number||"--",t.remark=t.remark||"--"}),o.tagList=e.data}).catch(e=>{o.loading=!1,console.log(e)})},N=P({onChange:(e,t)=>{console.log(`selectedRowKeys: ${e}`,"selectedRows: ",t),o.selectedRowKeys=e}}),O=e=>{if(e.status!==2){r.error("Order status wrong");return}G({id:e.id}).then(t=>{_(),r.success("Successfully scheduled")}).catch(t=>{r.error(t.msg||"操作失败")})},z=e=>{q({id:e.id}).then(t=>{_(),r.success("订单完成")}).catch(t=>{r.error(t.msg||"操作失败")})},K=e=>{if(e.status===8){r.error("订单已完成，无法取消");return}U({id:e.id}).then(t=>{_(),r.success("取消成功")}).catch(t=>{console.log(t.msg),r.error(t.msg||"操作失败")})},D=e=>{console.log("delete",e),I({ids:e.id}).then(t=>{_()}).catch(t=>{r.error(t.msg||"操作失败")})},$=()=>{if(console.log(o.selectedRowKeys),o.selectedRowKeys.length<=0){console.log("hello"),r.warn("请勾选删除项");return}I({ids:o.selectedRowKeys.join(",")}).then(e=>{r.success("删除成功"),o.selectedRowKeys=[],_()}).catch(e=>{r.error(e.msg||"操作失败")})};return(e,t)=>{const C=m("a-button"),B=m("a-space"),h=m("a-tag"),y=m("a-popconfirm"),w=m("a-divider"),L=m("a-table");return n(),v("div",null,[k("div",H,[k("div",Q,[g(B,null,{default:s(()=>[g(C,{danger:"",onClick:$},{default:s(()=>[p("Mass delete")]),_:1})]),_:1})]),g(L,{size:"middle",rowKey:"id",loading:u(o).loading,columns:u(R),"data-source":u(o).tagList,scroll:{x:"max-content"},"row-selection":u(N),pagination:{size:"default",current:u(o).page,pageSize:u(o).pageSize,onChange:l=>u(o).page=l,showSizeChanger:!1,showTotal:l=>`Total of ${l} data`}},{bodyCell:s(({text:l,record:i,index:ae,column:S})=>[S.key==="status"?(n(),v(T,{key:0},[l===8?(n(),d(h,{key:0,style:{"background-color":"#87d068",color:"black"}},{default:s(()=>[p("Done")]),_:1})):c("",!0),l===1?(n(),d(h,{key:1,style:{"background-color":"#d0686d",color:"black"}},{default:s(()=>[p("Pending payment")]),_:1})):c("",!0),l===7?(n(),d(h,{key:2,style:{"background-color":"#8468d0",color:"black"}},{default:s(()=>[p("Canceled")]),_:1})):c("",!0),l===2?(n(),d(h,{key:3,style:{"background-color":"#68d0c2",color:"black"}},{default:s(()=>[p("Paid")]),_:1})):c("",!0),l===6?(n(),d(h,{key:4,style:{"background-color":"#85d068",color:"black"}},{default:s(()=>[p("Scheduled")]),_:1})):c("",!0)],64)):c("",!0),S.key==="operation"?(n(),v("span",W,[i.status==6?(n(),d(y,{key:0,title:"Order done?","ok-text":"Yes","cancel-text":"No",onConfirm:b=>z(i)},{default:s(()=>[X]),_:2},1032,["onConfirm"])):c("",!0),i.status!=8?(n(),d(w,{key:1,type:"vertical"})):c("",!0),i.status!==8?(n(),d(y,{key:2,title:"Sure to cancel?","ok-text":"Yes","cancel-text":"No",onConfirm:b=>K(i)},{default:s(()=>[Z]),_:2},1032,["onConfirm"])):c("",!0),g(w,{type:"vertical"}),g(y,{title:"Sure to delete?","ok-text":"Yes","cancel-text":"No",onConfirm:b=>D(i)},{default:s(()=>[ee]),_:2},1032,["onConfirm"]),g(w,{type:"vertical"}),i.status===2?(n(),d(y,{key:3,title:"Add to lesson?","ok-text":"Yes","cancel-text":"No",onConfirm:b=>O(i)},{default:s(()=>[te]),_:2},1032,["onConfirm"])):c("",!0)])):c("",!0)]),_:1},8,["loading","columns","data-source","row-selection","pagination"])])])}}});const re=M(oe,[["__scopeId","data-v-aecd9325"]]);export{re as default};
