import{H as T}from"./header-ca487dae.js";import{c as A}from"./order-09e817fb.js";import{j as q,d as I,u as P,k as B,a as N,b as v,A as E,l as F,r as M,o as O,e as U,n as f,f as t,g as o,t as p,m as g,p as $,h as j}from"./index-da835352.js";import{l as H}from"./child-e825828b.js";import{_ as R}from"./_plugin-vue_export-helper-c27b6911.js";import"./k-logo-b1d5237f.js";import"./avatar-4ee3f7af.js";const V=async r=>q({url:"/CSAA/index/term/list",params:r,data:{},headers:{}}),c=r=>($("data-v-22b9a3fe"),r=r(),j(),r),W={class:"cart-page flex-view"},J={class:"left-flex"},z=c(()=>t("div",{class:"title flex-view"},[t("h3",null,"Order Details")],-1)),G={class:"cart-list-view"},K=c(()=>t("div",{class:"list-th flex-view"},[t("span",{class:"line-1"},"Class name"),t("span",{class:"line-2"},"Price")],-1)),L={class:"list"},Q={class:"items flex-view"},X={class:"book flex-view"},Y=["src"],Z={class:"pay"},ee={class:"title flex-view"},te=c(()=>t("label",null,[t("b",null,"Term:"),t("b",null,"   ")],-1)),se=c(()=>t("label",null,[t("b",null,"Child:"),t("b",null,"   ")],-1)),ae={class:"right-flex"},ie=c(()=>t("div",{class:"title flex-view"},[t("h3",null,"Settlement")],-1)),oe={class:"price-view"},ne={class:"price-item flex-view"},le=c(()=>t("span",null,"Num of classes:",-1)),ce={class:"price"},re={class:"font-big"},de={class:"total-price-view flex-view"},ue=c(()=>t("span",null,"Total",-1)),pe={class:"price"},me={class:"font-big"},_e={class:"btns-view"},ve=I({__name:"confirm",setup(r){const w=P(),d=B(),y=N(),e=v({id:void 0,title:void 0,cover:void 0,price:void 0,day:void 0,num:void 0,remark:"",count:1,amount:0,receiverName:void 0,receiverPhone:void 0,receiverAddress:void 0,expect_time:void 0,return_time:void 0,child:void 0}),l=v({term:[],loading:!1,keyword:""}),u=v({child:[],loading:!1}),m=v({time:[]});E(),F(()=>{e.id=d.query.id,e.title=d.query.title,e.cover=d.query.cover,e.price=d.query.price,e.day=d.query.day,e.amount=e.price?Number(e.price):0,b(),D()});const b=()=>{l.loading=!0,V({keyword:l.keyword}).then(a=>{l.loading=!1,console.log(a),a.data.forEach((s,i)=>{s.index=i+1}),l.term=a.data}).catch(a=>{l.loading=!1,console.log(a)})},D=()=>{u.loading=!0;let a=y.user_id;H({parent:a}).then(s=>{u.loading=!1,console.log(s),s.data.forEach((i,n)=>{i.index=n+1}),u.child=s.data}).catch(s=>{u.loading=!1,console.log(s)})},k={Sun:0,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6},x=()=>{let a=0;if(l.term.forEach(s=>{m.time===s.id&&(e.expect_time=s.expect_time,e.return_time=s.return_time,a=s.price)}),e.expect_time&&e.return_time&&e.price){let s=new Date(e.expect_time);const i=Date.now();if(s.getTime()<i){s=new Date;const n=new Date(e.return_time);Math.abs(n.getTime()-s.getTime());let h=0;for(let _=new Date(s);_<=n;_.setDate(_.getDate()+1))_.getDay()===k[e.day]&&h++;e.num=h,e.amount=e.price*h}else e.amount=a}},S=()=>{w.back(),console.log("back...")},C=()=>{const a=new FormData;let s=y.user_id;if(!s){g.warn("请先登录！");return}e.expect_time&&a.append("expect_time",e.expect_time),e.return_time&&a.append("return_time",e.return_time),a.append("term",m.time),a.append("child",e.child),a.append("user",s),a.append("thing",e.id?String(e.id):""),a.append("count","1"),a.append("num",e.num),a.append("amount",String(e.amount)),e.remark&&a.append("remark",e.remark),A(a).then(i=>{g.success("Please pay for the order"),w.push({name:"pay",query:{amount:e.amount}})}).catch(i=>{console.error(i),g.error(i.msg||"Failed")})};return(a,s)=>{const i=M("a-select");return O(),U("div",null,[f(T),t("section",W,[t("div",J,[z,t("div",G,[K,t("div",L,[t("div",Q,[t("div",X,[t("img",{src:o(e).cover},null,8,Y),t("h2",null,p(o(e).title),1),t("h2",null,"On "+p(o(e).day),1)]),t("div",Z,"¥"+p(o(e).price),1)])])]),t("div",ee,[t("div",null,[te,f(i,{placeholder:"Please select",allowClear:"",options:o(l).term,"field-names":{label:"title",value:"id"},value:o(m).time,"onUpdate:value":s[0]||(s[0]=n=>o(m).time=n),style:{width:"15vw"},onChange:x},null,8,["options","value"])]),t("div",null,[se,f(i,{placeholder:"Please select",allowClear:"",options:o(u).child,"field-names":{label:"name",value:"id"},value:o(e).child,"onUpdate:value":s[1]||(s[1]=n=>o(e).child=n),style:{width:"15vw"},onChange:x},null,8,["options","value"])])])]),t("div",ae,[ie,t("div",oe,[t("div",ne,[le,t("div",ce,[t("span",re,p(o(e).num),1)])]),t("div",de,[ue,t("div",pe,[t("span",me,"¥"+p(o(e).amount),1)])]),t("div",_e,[t("button",{class:"btn buy",onClick:s[2]||(s[2]=n=>S())},"Back"),t("button",{class:"btn pay jiesuan",onClick:s[3]||(s[3]=n=>C())},"Settle")])])])])])}}});const De=R(ve,[["__scopeId","data-v-22b9a3fe"]]);export{De as default};
